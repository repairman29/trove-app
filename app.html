<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trove Dashboard - Neon Arcade</title>
    <link rel="stylesheet" href="design-system.css">
    <style>
        /* Layout with Left Navigation */
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Left Navigation Styles */
        .left-nav {
            background-color: var(--bg-header);
            border-right: 1px solid var(--border-cyan);
            transition: width 0.3s ease;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .left-nav.expanded {
            width: 280px;
        }
        
        .left-nav.collapsed {
            width: 70px;
        }
        
        .nav-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-cyan);
            text-align: center;
        }
        
        .nav-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--laser-green);
            text-shadow: 0 0 10px var(--glow-green);
            margin-bottom: 5px;
        }
        
        .nav-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .nav-content {
            padding: 20px 0;
        }
        
        .nav-group {
            margin-bottom: 30px;
        }
        
        .nav-group-title {
            padding: 0 20px 10px 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .nav-item:hover {
            background-color: rgba(0, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background-color: rgba(0, 255, 255, 0.15);
            color: var(--text-primary);
            border-right: 3px solid var(--cyan);
        }
        
        .nav-item.active .nav-icon {
            color: var(--cyan);
            text-shadow: 0 0 10px var(--glow-cyan);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            margin-right: 15px;
            min-width: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .nav-text {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        
        .collapsed .nav-text {
            opacity: 0;
        }
        
        .nav-badge {
            background: var(--electric-magenta);
            color: var(--bg-dark);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            font-weight: bold;
        }
        
        .collapsed .nav-badge {
            display: none;
        }
        
        /* Create Button Styles */
        .create-button {
            background: linear-gradient(135deg, var(--laser-green), #00CC66);
            color: var(--bg-dark);
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            margin: 0 20px 20px 20px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 255, 127, 0.3);
        }
        
        .create-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 127, 0.4);
        }
        
        .create-dropdown {
            position: absolute;
            top: 100%;
            left: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-cyan);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .create-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        
        .dropdown-item:hover {
            background-color: rgba(0, 255, 255, 0.1);
        }
        
        .dropdown-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pro-badge {
            background: var(--electric-magenta);
            color: var(--bg-dark);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: auto;
        }
        
        /* Toggle Button */
        .nav-toggle {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border-cyan);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }
        
        .nav-toggle:hover {
            background: var(--cyan);
            color: var(--bg-dark);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
            background-color: var(--bg-dark);
        }
        
        .main-content.nav-collapsed {
            margin-left: 70px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .left-nav {
                transform: translateX(-100%);
            }
            
            .left-nav.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-nav-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1002;
                background: var(--bg-card);
                border: 1px solid var(--border-cyan);
                border-radius: 8px;
                padding: 10px;
                color: var(--text-primary);
                cursor: pointer;
            }
        }
        
        /* Existing Dashboard Styles */
        .dashboard-header {
            background-color: var(--bg-header);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid var(--border-cyan);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--laser-green), var(--cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-dark);
            font-weight: 700;
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px;
        }
        
        .stat-card {
            background-color: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-cyan);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px var(--glow-cyan);
        }
        
        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--laser-green);
            text-shadow: 0 0 10px var(--glow-green);
        }
        
        .stat-label {
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .collections-section {
            margin: 40px 30px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--electric-magenta);
            text-shadow: 0 0 8px var(--glow-magenta);
        }
        
        .collections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .collection-card {
            background-color: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-cyan);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .collection-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px var(--glow-cyan);
        }
        
        .collection-image {
            height: 150px;
            background: linear-gradient(45deg, var(--laser-green), var(--cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--bg-dark);
            position: relative;
        }
        
        .sub-collection-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 6px 12px;
            border: 2px solid var(--electric-magenta);
            box-shadow: 0 0 15px var(--glow-magenta);
            backdrop-filter: blur(5px);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 15px var(--glow-magenta);
            }
            100% {
                box-shadow: 0 0 25px var(--glow-magenta), 0 0 35px var(--glow-magenta);
            }
        }
        
        .stack-icon {
            font-size: 1rem;
            color: var(--electric-magenta);
        }
        
        .sub-count {
            background: var(--electric-magenta);
            color: var(--bg-dark);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 0 8px var(--glow-magenta);
        }
        
        .collection-content {
            padding: 20px;
        }
        
        .collection-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .collection-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .collection-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .collection-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-cyan);
            border-radius: 6px;
            padding: 8px 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        
        .action-btn:hover {
            background: var(--cyan);
            color: var(--bg-dark);
            box-shadow: 0 0 10px var(--glow-cyan);
        }
        
        .action-btn.secondary {
            background: transparent;
            border-color: var(--border-color);
        }
        
        .action-btn.secondary:hover {
            background: rgba(255, 105, 180, 0.1);
            border-color: var(--electric-magenta);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: var(--bg-card);
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--border-cyan);
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            font-weight: bold;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: var(--text-primary);
        }
        
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--laser-green);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--cyan);
            box-shadow: 0 0 10px var(--glow-cyan);
        }
        
        .form-help {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .template-library-link {
            margin-top: 10px;
            text-align: center;
        }
        
        .template-preview {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .template-preview h4 {
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .template-fields {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .btn {
            background: var(--cyan);
            color: var(--bg-dark);
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: var(--laser-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 255, 0.4);
        }
        
        .btn-primary {
            background: var(--laser-green);
        }
        
        .btn-primary:hover {
            background: var(--cyan);
        }
        
        /* Mobile Navigation Toggle */
        .mobile-nav-toggle {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-nav-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
        ☰
    </button>

    <!-- Left Navigation -->
    <nav class="left-nav expanded" id="leftNav">
        <div class="nav-header">
            <div class="nav-logo">🏺 Trove</div>
            <div class="nav-subtitle">Collection Manager</div>
        </div>
        
        <div class="nav-content">
            <!-- Group 1: Core Actions -->
            <div class="nav-group">
                <div class="nav-group-title">Create</div>
                <button class="create-button" onclick="toggleCreateDropdown()">
                    <span class="nav-icon">+</span>
                    <span class="nav-text">Create New</span>
                </button>
                <div class="create-dropdown" id="createDropdown">
                    <a href="#" class="dropdown-item" onclick="openCreateModal()">
                        <span class="nav-icon">📦</span>
                        <span>New Collection</span>
                    </a>
                    <a href="#" class="dropdown-item disabled" onclick="showProFeature()">
                        <span class="nav-icon">🔧</span>
                        <span>New Template</span>
                        <span class="pro-badge">Pro</span>
                    </a>
                </div>
            </div>
            
            <!-- Group 2: Your Library -->
            <div class="nav-group">
                <div class="nav-group-title">Your Library</div>
                <a href="#" class="nav-item active" onclick="showDashboard()">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showCollections()">
                    <span class="nav-icon">📚</span>
                    <span class="nav-text">My Collections</span>
                </a>
                <a href="#" class="nav-item" onclick="window.location.href='template-library.html'">
                    <span class="nav-icon">🏛️</span>
                    <span class="nav-text">Template Library</span>
                </a>
            </div>
            
            <!-- Group 3: Management & Settings -->
            <div class="nav-group">
                <div class="nav-group-title">Management</div>
                <a href="#" class="nav-item" onclick="showProfile()">
                    <span class="nav-icon">👤</span>
                    <span class="nav-text">My Profile</span>
                </a>
                <a href="#" class="nav-item" onclick="showAccountSettings()">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-text">Account Settings</span>
                </a>
                <a href="#" class="nav-item" onclick="window.location.href='settings-theme.html'">
                    <span class="nav-icon">🎨</span>
                    <span class="nav-text">Theme Selector</span>
                </a>
                <a href="#" class="nav-item" onclick="showDataManagement()">
                    <span class="nav-icon">💾</span>
                    <span class="nav-text">Data Management</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <span class="nav-icon">🚪</span>
                    <span class="nav-text">Logout</span>
                </a>
            </div>
        </div>
        
        <!-- Navigation Toggle -->
        <button class="nav-toggle" onclick="toggleNavigation()" title="Toggle Navigation">
            ◀
        </button>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
            <div class="dashboard-nav">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userInfo">Welcome back, Collector!</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Stats Overview -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalCollections">0</div>
                    <div class="stat-label">Collections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalItems">0</div>
                    <div class="stat-label">Items Cataloged</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalValue">$0</div>
                    <div class="stat-label">Total Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="recentActivity">0</div>
                    <div class="stat-label">Recent Activity</div>
                </div>
            </div>

            <!-- Collections Section -->
            <section class="collections-section">
                <div class="section-header">
                    <h2 class="section-title">Your Collections</h2>
                    <button class="btn btn-primary" onclick="openCreateModal()">Create Collection</button>
                </div>
                
                <div class="collections-grid" id="collectionsGrid">
                    <!-- Collections will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Create Collection Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateModal()">&times;</span>
            <h2 class="modal-title">Create New Collection</h2>
            <form id="createCollectionForm">
                <div class="form-group">
                    <label class="form-label" for="collectionTemplate">Collection Type</label>
                    <select id="collectionTemplate" class="form-input" onchange="updateTemplateFields()">
                        <option value="general">General Collection</option>
                        <option value="vinyl">Vinyl Records</option>
                        <option value="custom">Custom Template</option>
                    </select>
                    <small class="form-help">Choose a template to get specialized fields for your collection type</small>
                    <div class="template-library-link">
                        <a href="template-library.html" style="color: var(--laser-green); text-decoration: none; font-size: 0.9rem;">
                            🏛️ Browse more templates in the Template Library
                        </a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="collectionName">Collection Name</label>
                    <input type="text" id="collectionName" class="form-input" placeholder="e.g., Vintage Comic Books" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="collectionDescription">Description</label>
                    <textarea id="collectionDescription" class="form-input" rows="3" placeholder="Describe your collection..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="collectionTags">Tags (comma separated)</label>
                    <input type="text" id="collectionTags" class="form-input" placeholder="comics, vintage, superhero">
                </div>
                
                <!-- Template Preview -->
                <div id="templatePreview" class="template-preview" style="display: none;">
                    <h4>Template Fields Preview</h4>
                    <div id="templateFields"></div>
                </div>
                
                <button type="submit" class="btn btn-primary">Create Collection</button>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2 class="modal-title">My Profile</h2>
            <div id="profileContent">
                <!-- Profile content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAccountModal()">&times;</span>
            <h2 class="modal-title">Account Settings</h2>
            <div id="accountContent">
                <!-- Account settings content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Data Management Modal -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDataModal()">&times;</span>
            <h2 class="modal-title">Data Management</h2>
            <div id="dataContent">
                <!-- Data management content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Demo Mode (set DEMO_MODE = false for production) -->
    <script src="demo-mode.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- Collection Templates -->
    <script src="collection-templates.js"></script>
    
    <!-- Collection Management -->
    <script src="collections.js"></script>
    
    <!-- Subscription Management -->
    <script src="subscription.js"></script>
    
    <script>
        // Navigation State Management
        let navCollapsed = localStorage.getItem('navCollapsed') === 'true';
        
        // Initialize navigation state
        function initializeNavigation() {
            const leftNav = document.getElementById('leftNav');
            const mainContent = document.getElementById('mainContent');
            
            if (navCollapsed) {
                leftNav.classList.remove('expanded');
                leftNav.classList.add('collapsed');
                mainContent.classList.add('nav-collapsed');
                document.querySelector('.nav-toggle').innerHTML = '▶';
            }
        }
        
        // Toggle navigation
        function toggleNavigation() {
            const leftNav = document.getElementById('leftNav');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.querySelector('.nav-toggle');
            
            navCollapsed = !navCollapsed;
            localStorage.setItem('navCollapsed', navCollapsed);
            
            if (navCollapsed) {
                leftNav.classList.remove('expanded');
                leftNav.classList.add('collapsed');
                mainContent.classList.add('nav-collapsed');
                toggleBtn.innerHTML = '▶';
            } else {
                leftNav.classList.remove('collapsed');
                leftNav.classList.add('expanded');
                mainContent.classList.remove('nav-collapsed');
                toggleBtn.innerHTML = '◀';
            }
        }
        
        // Mobile navigation
        function toggleMobileNav() {
            const leftNav = document.getElementById('leftNav');
            leftNav.classList.toggle('mobile-open');
        }
        
        // Create dropdown
        function toggleCreateDropdown() {
            const dropdown = document.getElementById('createDropdown');
            dropdown.classList.toggle('show');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('createDropdown');
            const createButton = document.querySelector('.create-button');
            
            if (!createButton.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        // Navigation item click handlers
        function showDashboard() {
            setActiveNavItem('dashboard');
            // Dashboard is already visible
        }
        
        function showCollections() {
            setActiveNavItem('collections');
            // Could load a collections-only view
        }
        
        function showProfile() {
            setActiveNavItem('profile');
            openProfileModal();
        }
        
        function showAccountSettings() {
            setActiveNavItem('account');
            openAccountModal();
        }
        
        function showDataManagement() {
            setActiveNavItem('data');
            openDataModal();
        }
        
        function setActiveNavItem(item) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            event.target.closest('.nav-item').classList.add('active');
        }
        
        // Modal functions
        function openProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            loadProfileContent();
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }
        
        function openAccountModal() {
            document.getElementById('accountModal').style.display = 'block';
            loadAccountContent();
        }
        
        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
        }
        
        function openDataModal() {
            document.getElementById('dataModal').style.display = 'block';
            loadDataContent();
        }
        
        function closeDataModal() {
            document.getElementById('dataModal').style.display = 'none';
        }
        
        function openCreateModal() {
            document.getElementById('createModal').style.display = 'block';
            loadCustomTemplatesInModal();
        }
        
        function closeCreateModal() {
            document.getElementById('createModal').style.display = 'none';
        }
        
        function showProFeature() {
            alert('Template Builder is a Pro feature. Please upgrade to create custom templates.');
        }
        
        // Load modal content
        function loadProfileContent() {
            const content = document.getElementById('profileContent');
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, var(--laser-green), var(--cyan)); display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 2rem; color: var(--bg-dark);">
                        U
                    </div>
                    <h3 style="color: var(--text-primary); margin-bottom: 5px;">User Profile</h3>
                    <p style="color: var(--text-secondary);">user@example.com</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                        <div style="font-size: 1.5rem; color: var(--laser-green); font-weight: bold;">12</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Collections</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                        <div style="font-size: 1.5rem; color: var(--laser-green); font-weight: bold;">156</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Items Cataloged</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="width: 100%;">Edit Profile</button>
            `;
        }
        
        function loadAccountContent() {
            const content = document.getElementById('accountContent');
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Subscription & Billing</h4>
                    <div style="background: var(--bg-dark); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--text-primary);">Current Plan</span>
                            <span style="color: var(--laser-green); font-weight: bold;">Free</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Upgrade to Pro</button>
                    <button class="btn" style="width: 100%;">Manage Billing</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Account Security</h4>
                    <button class="btn" style="width: 100%; margin-bottom: 10px;">Change Password</button>
                    <button class="btn" style="width: 100%;">Update Email</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Notifications</h4>
                    <div style="background: var(--bg-dark); padding: 15px; border-radius: 8px;">
                        <label style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" checked style="margin-right: 10px;">
                            <span style="color: var(--text-primary);">Email notifications</span>
                        </label>
                        <label style="display: flex; align-items: center;">
                            <input type="checkbox" checked style="margin-right: 10px;">
                            <span style="color: var(--text-primary);">In-app notifications</span>
                        </label>
                    </div>
                </div>
            `;
        }
        
        function loadDataContent() {
            const content = document.getElementById('dataContent');
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Import Data</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Upload a CSV file to bulk-import items into your collection.</p>
                    <input type="file" accept=".csv" style="width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary);">
                    <button class="btn btn-primary" style="width: 100%; margin-top: 10px;">Import Data</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Export Data</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Export your collections for backup or insurance purposes.</p>
                    <button class="btn" style="width: 100%; margin-bottom: 10px;">Export as CSV</button>
                    <button class="btn" style="width: 100%;">Export as PDF</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">Danger Zone</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Permanently delete your account and all associated data.</p>
                    <button class="btn" style="width: 100%; background: #dc3545; color: white;">Delete Account</button>
                </div>
            `;
        }
        
        // Check authentication state
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                updateUserInfo();
                // Collections will be loaded automatically by firebase-config.js
            } else {
                // User is not authenticated, redirect to auth page
                window.location.href = 'auth.html';
            }
        });

        // Update user info in the UI
        async function updateUserInfo() {
            const currentUser = AuthUtils.getCurrentUser();
            if (currentUser) {
                const userInfo = document.querySelector('#userInfo');
                const userAvatar = document.querySelector('#userAvatar');
                
                if (userInfo) {
                    userInfo.textContent = `Welcome back, ${currentUser.displayName || 'Collector'}!`;
                }
                
                if (userAvatar) {
                    if (currentUser.photoURL) {
                        userAvatar.innerHTML = `<img src="${currentUser.photoURL}" alt="Profile" style="width: 32px; height: 32px; border-radius: 50%;">`;
                    } else {
                        userAvatar.textContent = (currentUser.displayName?.charAt(0) || currentUser.email?.charAt(0) || 'U').toUpperCase();
                    }
                }
                
                // Check if user has admin privileges
                await checkAndShowAdminButton(currentUser);
            }
        }
        
        async function checkAndShowAdminButton(user) {
            try {
                const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    if (userData.role === 'admin' || userData.role === 'support') {
                        // Add admin button to navigation if needed
                    }
                }
            } catch (error) {
                console.error('Error checking admin privileges:', error);
            }
        }
        
        function logout() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'auth.html';
            }).catch((error) => {
                console.error('Error signing out:', error);
            });
        }

        // Theme Management
        const themes = {
            'neon-arcade': {
                name: 'Neon Arcade',
                colors: {
                    '--bg-dark': '#0a0a0a',
                    '--bg-header': '#1a1a1a',
                    '--bg-card': '#1e1e1e',
                    '--text-primary': '#ffffff',
                    '--text-secondary': '#cccccc',
                    '--laser-green': '#00ff7f',
                    '--cyan': '#00d4ff',
                    '--electric-magenta': '#ff00ff',
                    '--border-cyan': '#00d4ff',
                    '--glow-green': 'rgba(0, 255, 127, 0.5)',
                    '--glow-cyan': 'rgba(0, 212, 255, 0.5)'
                }
            },
            'collectors-study': {
                name: 'Collector\'s Study',
                colors: {
                    '--bg-dark': '#F5F5F5',
                    '--bg-header': '#FFFFFF',
                    '--bg-card': '#FFFFFF',
                    '--text-primary': '#222222',
                    '--text-secondary': '#666666',
                    '--laser-green': '#002147',
                    '--cyan': '#1a4b84',
                    '--electric-magenta': '#8B4513',
                    '--border-cyan': '#E0E0E0',
                    '--glow-green': 'rgba(0, 33, 71, 0.3)',
                    '--glow-cyan': 'rgba(26, 75, 132, 0.3)'
                }
            },
            '8bit-bliss': {
                name: '8-Bit Bliss',
                colors: {
                    '--bg-dark': '#1A237E',
                    '--bg-header': '#0D47A1',
                    '--bg-card': '#2962FF',
                    '--text-primary': '#E0E0E0',
                    '--text-secondary': '#BDBDBD',
                    '--laser-green': '#FF5722',
                    '--cyan': '#FF9800',
                    '--electric-magenta': '#FFC107',
                    '--border-cyan': '#2962FF',
                    '--glow-green': 'rgba(255, 87, 34, 0.5)',
                    '--glow-cyan': 'rgba(255, 152, 0, 0.5)'
                }
            },
            'y2k-dream': {
                name: 'Y2K Dream',
                colors: {
                    '--bg-dark': 'linear-gradient(135deg, #E3F2FD, #F3E5F5)',
                    '--bg-header': 'rgba(255, 255, 255, 0.9)',
                    '--bg-card': 'rgba(255, 255, 255, 0.8)',
                    '--text-primary': '#333333',
                    '--text-secondary': '#666666',
                    '--laser-green': '#00FFFF',
                    '--cyan': '#FF69B4',
                    '--electric-magenta': '#FF1493',
                    '--border-cyan': '#00FFFF',
                    '--glow-green': 'rgba(0, 255, 255, 0.5)',
                    '--glow-cyan': 'rgba(255, 105, 180, 0.5)'
                }
            },
            'comic-inked': {
                name: 'Comic Book Inked',
                colors: {
                    '--bg-dark': '#F5F5F5',
                    '--bg-header': '#FFFFFF',
                    '--bg-card': '#FFFFFF',
                    '--text-primary': '#333333',
                    '--text-secondary': '#666666',
                    '--laser-green': '#D32F2F',
                    '--cyan': '#FBC02D',
                    '--electric-magenta': '#FF5722',
                    '--border-cyan': '#D32F2F',
                    '--glow-green': 'rgba(211, 47, 47, 0.5)',
                    '--glow-cyan': 'rgba(251, 192, 45, 0.5)'
                }
            },
            'minimalist-mint': {
                name: 'Minimalist Mint',
                colors: {
                    '--bg-dark': '#FFFFFF',
                    '--bg-header': '#FAFAFA',
                    '--bg-card': '#FAFAFA',
                    '--text-primary': '#333333',
                    '--text-secondary': '#666666',
                    '--laser-green': '#A5D6A7',
                    '--cyan': '#81C784',
                    '--electric-magenta': '#66BB6A',
                    '--border-cyan': '#A5D6A7',
                    '--glow-green': 'rgba(165, 214, 167, 0.5)',
                    '--glow-cyan': 'rgba(129, 199, 132, 0.5)'
                }
            }
        };

        function applyTheme(themeId) {
            const theme = themes[themeId];
            if (!theme) return;

            const root = document.documentElement;
            Object.entries(theme.colors).forEach(([property, value]) => {
                root.style.setProperty(property, value);
            });

            // Update theme indicator if it exists
            const themeIndicator = document.querySelector('.theme-indicator');
            if (themeIndicator) {
                themeIndicator.textContent = theme.name;
            }
        }

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('trove-theme');
            if (savedTheme && themes[savedTheme]) {
                applyTheme(savedTheme);
            } else {
                // Default to neon-arcade
                applyTheme('neon-arcade');
            }
        }

        // Initialize navigation and theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            loadSavedTheme();
        });
    </script>
</body>
</html> 